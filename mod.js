var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{mp:()=>n,i9:()=>a,dR:()=>o,ji:()=>i,f2:()=>s,ow:()=>r});class n{constructor(t,e=[]){this.data=t;const n={data:t,children:[]};for(const{level:t,data:o}of e){let e=n;for(let n=1;n<t;n++){const t=e.children;t.length>0?e=t[t.length-1]:(e={data:void 0,children:[]},t.push(e))}e.children.push({data:o,children:[]})}this.children=n.children}}function o(t,e){const o=[];for(const n of t.indexInfoArray)"heading"===n.orbit&&o.push({level:n.index.length,data:{string:e(n.unit),href:`#${encodeURIComponent(n.id)}`}});return new n({string:t.title,href:"#"},o)}function i(t){const e=document.createElement("details"),n=document.createElement("summary"),o=document.createElement("a");e.open=!0,void 0!==t.data&&(o.href=t.data.href,o.textContent=t.data.string),e.append(n),n.append(o);for(const n of t.children)e.append(i(n));return e}const{getMod:c}=function(t){const e={},n=new EventTarget;for(const o in t)n.addEventListener(`load-${o}`,(async()=>{e[o]=await new Function(`return import(${JSON.stringify(t[o])})`)(),n.dispatchEvent(new Event(`loaded-${o}`))}),{once:!0});return{getMod:async function(t){const o=e[t];return void 0!==o?o:(n.dispatchEvent(new Event(`load-${t}`)),new Promise((o=>{n.addEventListener(`loaded-${t}`,(()=>{o(e[t])}))})))}}}({stc:"https://cdn.jsdelivr.net/gh/st-org/stc@0.23.2/mod.js",stui:"https://cdn.jsdelivr.net/gh/st-org/stui@0.15.6/mod.js",ucs:"https://cdn.jsdelivr.net/gh/st-org/st-std@0.29.1/ucs.js"});function s(t){return t.trim().split(/\s+/).map((t=>/^\d+$/.test(t)?Number(t):t.startsWith('"')?t.slice(1,-1):t))}function r(t,e,n){const o=[];if(0===e.length||0===n.length)return o;const i=e[0];if("number"!=typeof i)return o;let c=n[Math.min(i+t,n.length-1)];o.push(c);for(let t=1;t<e.length;t++){const n=e[t];if("number"==typeof n){if(Array.isArray(c)){const t=c[n];if("object"!=typeof t)break;o.push(c=t);continue}const t=c.children[n];if(void 0===t)break;o.push(c=t);continue}if(Array.isArray(c))break;const i=c.options[n];if(!Array.isArray(i))break;const s=e[++t];if("number"!=typeof s)break;const r=i[s];if(void 0===r)break;o.push(c=r)}return o}async function a(){const{element:t,main:e,sideContent:n,article:a,settings:d}=(await c("stui")).createASStruct(),l=document.createElement("style"),u=document.createElement("nav");n.prepend(u);const f=[],m={};async function h(t,e,n){const{compiler:o}=m;if(void 0===o)return;let i;if(void 0!==t){o.urls.isRelURL(t)&&(t=new URL(t,location.href).href);const{origin:e,pathname:n}=new URL(t),{parts:c}=o.context;for(const t of c){const o=new URL(t.url);if(o.origin===e&&o.pathname===n){i=t;break}}}let c=a;if(void 0!==e){let t=0;void 0!==i&&(t=o.context.partToOffset.get(i)??0);const n=r(t,s(e),o.context.stdn);for(let t=n.length-1;t>=0;t--){const e=o.unitOrLineToElements.get(n[t]);if(void 0!==e&&e.length>0){c=e[e.length-1];break}}}if(void 0!==n){const t=c.querySelector(`[id=${JSON.stringify(n)}]`);null!==t&&(c=t)}if(c!==a){let t=!1;const e=()=>{t=!0};addEventListener("click",e,{once:!0}),addEventListener("keydown",e,{once:!0}),addEventListener("touchmove",e,{once:!0}),addEventListener("wheel",e,{once:!0});for(let e=0;e<100&&!t;e++)Math.abs(c.getBoundingClientRect().top)>1&&c.scrollIntoView(),await new Promise((t=>setTimeout(t,100)))}}function p({compiler:t,documentFragment:e}){document.title=t.context.title,a.innerHTML="",a.append(e),u.innerHTML="",u.append(i(o(t.context,t.base.unitToInlinePlainString))),m.compiler=t}async function g(t){const{compileURLs:e}=await c("stc");p(await e(t,{builtInTagToUnitCompiler:await c("ucs"),style:l}))}async function v(t){const{compile:e}=await c("stc");p(await e([{value:t,url:location.href}],{builtInTagToUnitCompiler:await c("ucs"),style:l}))}return a.addEventListener("dblclick",(async t=>{const{compiler:e}=m;if(void 0!==e)for(const n of t.composedPath()){if(!(n instanceof HTMLElement||n instanceof SVGElement))continue;const t=e.elementToUnitOrLine.get(n);if(void 0===t)continue;const o=e.context.unitOrLineToPart.get(t);if(void 0===o)continue;const i=e.context.partToOffset.get(o);if(void 0===i)continue;const c=e.context.unitOrLineToPosition.get(t);if(void 0!==c){for(const t of f)await t(o,i,c);return}}})),{element:t,style:l,main:e,sideContent:n,article:a,nav:u,settings:d,dblClickLineListeners:f,env:m,focus:h,load:g,loadString:v,autoLoad:async function(){const t=new URLSearchParams(location.search),e=t.get("focus-url")??document.documentElement.dataset.focusUrl,n=t.get("focus-position")??document.documentElement.dataset.focusPosition;let o;o=location.hash.length>1?decodeURIComponent(location.hash.slice(1)):document.documentElement.dataset.focusId;const i=t.get("string")??document.documentElement.dataset.string,c=t.get("src")??document.documentElement.dataset.src;void 0!==i?await v(i):void 0!==c&&await g([c]),await h(e,n,o)}}}var d=e.mp,l=e.i9,u=e.dR,f=e.ji,m=e.f2,h=e.ow;export{d as Tree,l as createViewer,u as extractHeadingTree,f as headingTreeToElement,m as parsePositionStr,h as positionToUnitOrLines};